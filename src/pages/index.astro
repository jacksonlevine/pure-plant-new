---
import Layout from '../layouts/Layout.astro';
import PrimaryHeroSection from "../components/PrimaryHeroSection.astro";
import VitaminD3TruthRevelation from "../components/VitaminD3TruthRevelation.astro";
import TrustSignalsCertificationShowcase from "../functional-components/TrustSignalsCertificationShowcase"
import ProductsStrip from "../components/ProductsStrip.astro";
import CTAButton from "../components/CTAButton.astro";

//JSON LD stuff

import productInfo from "../assets/json/staticproductinfo.json";
import {
    getProductAggregateRating,
    getProductReviewStructuredData,
} from "../lib/reviews";


const site = Astro.site ?? new URL("https://jacksonlevine.github.io");
const basePath = import.meta.env.BASE_URL ?? "/";
const siteBase = new URL(basePath, site).toString().replace(/\/$/, "");
const canonicalUrl = new URL(Astro.url.pathname, site).toString();

const featuredProducts = [
    {
        key: "serophan",
        name: "Serophan",
    },
    {
        key: "neurozine",
        name: "Neurozine",
    },
    {
        key: "pureplantd3",
        name: "PurePlant D3",
    },
];

const featuredProductsWithSchema = featuredProducts.map((product) => {
    const aggregateRating = getProductAggregateRating(product.key);
    const reviews = getProductReviewStructuredData(product.key);

    return {
        ...product,
        description: productInfo[product.key].description,
        url: `${siteBase}/products/${product.key}`,
        id: `${siteBase}/products/${product.key}#product`,
        aggregateRating,
        reviews,
    };
});

const featuredProductNodes = featuredProductsWithSchema.map((product) => ({
    "@type": "Product",
    "@id": product.id,
    name: product.name,
    description: product.description,
    brand: {
        "@type": "Brand",
        name: "Pure Plant",
    },
    url: product.url,
    ...(product.aggregateRating ? { aggregateRating: product.aggregateRating } : {}),
    ...(product.reviews.length ? { review: product.reviews } : {}),
}));


const homepageStructuredData = [
    {
        "@type": "WebPage",
        "@id": `${canonicalUrl}#webpage`,
        url: canonicalUrl,
        name: "Pure Plant Supplements for Mood, Cognition, and Immunity",
        description:
            "Discover Pure Plant's precision-formulated supplements including Serophan for mood, Neurozine for focus, and PurePlant D3 for immune health.",
        isPartOf: {
            "@id": `${siteBase}/#website`,
        },
        inLanguage: "en",
        about: featuredProductsWithSchema.map((product) => ({
            "@type": "Product",
            "@id": product.id,
        })),
    },
    {
        "@type": "ItemList",
        "@id": `${canonicalUrl}#featured-products`,
        name: "Featured Pure Plant Supplements",
        description: "Curated lineup of Pure Plant's flagship supplements.",
        itemListElement: featuredProductsWithSchema.map((product, index) => ({
            "@type": "ListItem",
            position: index + 1,
            name: product.name,
            item: {
                "@type": "Product",
                "@id": product.id,
            },
        })),
    },
    ...featuredProductNodes,
];

---

<Layout
        title="Pure Plant Supplements"
        description="Pure Plant delivers precision-formulated supplements like Serophan, Neurozine, and PurePlant D3 for elevated mood, cognition, and immunity."
        structuredData={homepageStructuredData}
>
    <PrimaryHeroSection isTopElement={true}/>
    <ProductsStrip />
    <TrustSignalsCertificationShowcase client:load/>
    <div class="w-full text-center min-h-[10rem]">
        <h3 class="py-[2rem]">Our premium bottles are made from sustainable recycled glass. No plastic waste, earth-friendly and infinitely reusable.</h3>
        <CTAButton invert={true} label="Learn more about our sustainable impact." href="/pure-plant-new/vitamind3truth"/>
    </div>
</Layout>
