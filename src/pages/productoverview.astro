---
import ProductShowcaseSection from "../components/ProductShowcaseSection.astro"
import type ProductShowcaseContent from "../components/ProductShowcaseSection.astro";
import Layout from "../layouts/Layout.astro";

import staticProductInfo from "../assets/json/staticproductinfo.json";

import {
    getProductAggregateRating,
    getProductReviewStructuredData,
} from "../lib/reviews";

const cognitiveTransform = staticProductInfo.neurozine;

const neurotransmittedPrecision = staticProductInfo.serophan;

const cellularOptimization = staticProductInfo.pureplantd3;

//JSON LD stuff

const site = Astro.site ?? new URL("https://jacksonlevine.github.io");
const basePath = import.meta.env.BASE_URL ?? "/";
const siteBase = new URL(basePath, site).toString().replace(/\/$/, "");
const canonicalUrl = new URL(Astro.url.pathname, site).toString();

const showcaseProducts: { key: keyof typeof staticProductInfo; name: string }[] = [
    { key: "neurozine", name: "Neurozine" },
    { key: "serophan", name: "Serophan" },
    { key: "pureplantd3", name: "PurePlant D3" },
];

const showcaseProductsWithSchema = showcaseProducts.map((product) => {
    const aggregateRating = getProductAggregateRating(product.key);
    const reviews = getProductReviewStructuredData(product.key);
    const defaultProductUrl = `${siteBase}/products/${product.key}`;
    const resolvedUrl = staticProductInfo[product.key].productLink
        ? `${site.origin}${staticProductInfo[product.key].productLink}`
        : defaultProductUrl;

    return {
        ...product,
        id: `${defaultProductUrl}#product`,
        url: resolvedUrl,
        aggregateRating,
        reviews,
    };
});

const showcaseProductNodes = showcaseProductsWithSchema.map((product) => ({
    "@type": "Product",
    "@id": product.id,
    name: product.name,
    description: staticProductInfo[product.key].description,
    brand: {
        "@type": "Brand",
        name: "Pure Plant",
    },
    url: product.url,
    ...(product.aggregateRating ? { aggregateRating: product.aggregateRating } : {}),
    ...(product.reviews.length ? { review: product.reviews } : {}),
}));


const structuredData = [
    {
        "@type": "WebPage",
        "@id": `${canonicalUrl}#webpage`,
        url: canonicalUrl,
        name: "Pure Plant Product Overview",
        description:
            "Dive into Pure Plant's flagship supplements—Neurozine, Serophan, and PurePlant D3—to understand their targeted benefits and science-backed formulations.",
        isPartOf: {
            "@id": `${siteBase}/#website`,
        },
        inLanguage: "en",
    },
    {
        "@type": "ItemList",
        "@id": `${canonicalUrl}#overview-products`,
        name: "Pure Plant Flagship Supplement Overview",
        itemListElement: showcaseProductsWithSchema.map((product, index) => ({
            "@type": "ListItem",
            position: index + 1,
            name: product.name,
            item: {
                "@type": "Product",
                "@id": product.id,
            },
        })),
    },
    ...showcaseProductNodes,
];
---
<Layout
        title="Pure Plant Product Overview"
        description="Understand what makes Pure Plant's Serophan, Neurozine, and PurePlant D3 unique through our immersive product showcase."
        structuredData={structuredData}
>
    <!--<video-->
    <!--        class="fixed top-0 left-0 w-full h-full object-cover z-[-50]"-->
    <!--        autoplay-->
    <!--        muted-->
    <!--        loop-->
    <!--        playsinline-->
    <!--&gt;-->
    <!--    <source src={landing2} type="video/mp4" />-->
    <!--</video>-->
    <script>
        import('@google/model-viewer/dist/model-viewer');
    </script>
    <ProductShowcaseSection content={cognitiveTransform} isTopElement={true}/>
    <ProductShowcaseSection content={neurotransmittedPrecision} />
    <ProductShowcaseSection content={cellularOptimization} />
</Layout>

